<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/chart-elements/chart-elements.html">
<link rel="import" href="../bower_components/paper-input-autocomplete-chips/paper-input-autocomplete-chips.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../brower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-input-autocomplete/paper-input-autocomplete.html">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<dom-module id="my-view1">
  <template id="app">
    <chart-pie id="chart" class="square-chart" data="[[data]]"></chart-pie>
    <!--<iron-ajax id="requestRepos" method="GET" handle-as="json" Â url="http://localhost:55911/api/values" on-response="handleResponse">-->
    <!--<iron-ajax auto url="http://localhost:53145/api/nuxeoconnect/coverage" handle-as="json" last-response="{{ajaxResponse}}"></iron-ajax>-->
    <!--<template is="dom-repeat" items="[[ajaxResponse]]">
      <span>{{item}}</span>
    </template>-->

    <div>
      <!--<paper-material class="demo-paper" style="height: 300px; overflow: auto;">-->
      <!--<p>An example of <code>&lt;paper-input-autocomplete-chips&gt;</code>:</p>-->
      <paper-input-autocomplete-chips local-candidates="{{regions}}" label="Continents"></paper-input-autocomplete-chips>
        <paper-input-autocomplete-chips local-candidates="{{nature}}" label="Nature"></paper-input-autocomplete-chips>
          <paper-input-autocomplete-chips local-candidates="{{subject}}" label="Subjects"></paper-input-autocomplete-chips>
            <!--<iron-icon icon="visibility" prefix></iron-icon>
          <iron-icon icon="visibility" suffix></iron-icon>-->
          <!--</paper-material>-->
    </div>
    </iron-ajax>
  </template>

  <script>
    regions = ["asia", "africa", "europe", "antartica"]
    subjects = ["art", "sciences", "daily life", "human sciences", "society", "technology"]
    nature = ["application", "article", "contract", "bankAccountDetails", "booklet", "letter", "loanApplication"]

    function formAutoCompleteArray(array) {
      returnArray = []
      for (var key in array) {
        var item = {
          key: key,
          text: array[key],
          inactive: true
        };
        returnArray.push(item)
      }
      return returnArray;
    }

    function initializechart() {
      var scope = document.querySelector('#chart');
      //  console.log("Message here")
      //  console.log(scope)
      scope.data = {
        labels: [
          "Red",
          "Green",
          "Yellow"
        ],
        datasets: [
          {
            data: [300, 50, 100],
            backgroundColor: [
              "#FF6384",
              "#36A2EB",
              "#FFCE56"
            ],
            hoverBackgroundColor: [
              "#FF6384",
              "#36A2EB",
              "#FFCE56"
            ]
          }]
      };

      scope.resize = function () {
        this.$.chart.style.width = this.$.newWidth.value;
        this.$.chart.style.height = this.$.newHeight.value;
        this.$.chart.resize();
      };
    }

    function setSuggestions() {
      $.ajax({
        type: 'GET',
        dataType: 'jsonp',
        url: 'http://localhost:53145/api/nuxeoconnect/coverage',
        jsonpCallback: 'showResult',
        error: function (data, msg) {
          alert("Error");
          alert(msg);
        },
        success: function (data) {
          console.log(data)
          array = [];
          for (var r in data) {
            var item = {
              key: r,
              text: data[r],
              inactive: true
            };
            array.push(item)
          }
          // this.set("myarray",array);
          this.myarray = array;
          this.notifyPath('myarray', this.myarray)
          alert(array.toSource());
          alert(this.myArray.toSource());
        }
      });
    }

    function showResult(json) {
      alert(json);
    }
    Polymer({
      is: 'my-view1',
      properties: {
        regions: {
          type: Array,
          value: formAutoCompleteArray(regions),
        },
        nature: {
          type: Array,
          value: formAutoCompleteArray(nature),
        },
        subject: {
          type: Array,
          value: formAutoCompleteArray(subjects),
        }
      },
      ready: function () {
        console.log("Called")
        // document.querySelector("#requestRepos").generateRequest();
        initializechart();
        // setSuggestions();
        // $.ajax({
        //   type: 'GET',
        //   dataType: 'jsonp',
        //   url: 'http://localhost:53145/api/nuxeoconnect',
        //   jsonpCallback: 'showResult',
        //   error: function (data, msg) {
        //     alert("Error");
        //     alert(msg);
        //   },
        //   success: function (data) {
        //     alert('success')
        //     console.log(data)
        //   }
        // });
        //return false;
      }
    });
  </script>
</dom-module>